name: Deploy to Databricks

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: üì• Checkout code
      uses: actions/checkout@v3

    - name: üîç Proveri da li su secrets postavljeni
      run: |
        [ -z "$DATABRICKS_HOST" ] && { echo "‚ùå DATABRICKS_HOST nije postavljen"; exit 1; }
        [ -z "$DATABRICKS_TOKEN" ] && { echo "‚ùå DATABRICKS_TOKEN nije postavljen"; exit 1; }
      env:
        DATABRICKS_HOST: ${{ secrets.DATABRICKS_HOST }}
        DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}

    - name: üß™ Prika≈æi poƒçetak tokena (DEBUG)
      run: |
        echo "HOST=${DATABRICKS_HOST:0:10}..."
        echo "TOKEN=${DATABRICKS_TOKEN:0:5}..."
      env:
        DATABRICKS_HOST: ${{ secrets.DATABRICKS_HOST }}
        DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}

    - name: üì¶ Instaliraj Databricks CLI
      run: pip install databricks-cli

    - name: ‚öôÔ∏è Konfiguri≈°i CLI sa tokenom
      env:
        DATABRICKS_HOST: ${{ secrets.DATABRICKS_HOST }}
        DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}
      run: |
        cat <<EOF | databricks configure --token
$DATABRICKS_HOST
$DATABRICKS_TOKEN
EOF

    - name: üöÄ Deploy notebook u /Shared
      run: |
        databricks workspace import etl_srbija.py \
          /Shared/etl_srbija \
          --language PYTHON --format SOURCE --overwrite



