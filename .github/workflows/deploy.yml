name: Deploy to Databricks

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Install Databricks CLI
      run: pip install databricks-cli

    - name: Configure CLI
      run: |
        mkdir -p ~/.databricks
        echo "[DEFAULT]"            >  ~/.databricks/config
        echo "host = $DATABRICKS_HOST"   >> ~/.databricks/config
        echo "token = $DATABRICKS_TOKEN" >> ~/.databricks/config
      env:
        DATABRICKS_HOST:  ${{ secrets.DATABRICKS_HOST }}
        DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}

    # DEBUG – potvrdi da je token upisan
    - name: DEBUG – show config
      run: cat ~/.databricks/config | sed 's/token = .*/token = ***MASKED***/'

    - name: Upload notebook
      run: |
        databricks workspace import etl_srbija.py \
          /Users/kajkusemil2103@gmail.com/etl/etl_srbija.py \
          --language PYTHON \
          --format SOURCE \
          --overwrite
      env:
        DATABRICKS_HOST:  ${{ secrets.DATABRICKS_HOST }}
        DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}


