name: Deploy to Databricks

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: ðŸ” Check secrets
      run: |
        [ -z "$DATABRICKS_HOST" ] && { echo "âŒ HOST empty"; exit 1; }
        [ -z "$DATABRICKS_TOKEN" ] && { echo "âŒ TOKEN empty"; exit 1; }
    - name: Install CLI
      run: pip install databricks-cli

    - name: Configure CLI
      run: |
        mkdir -p ~/.databricks
        {
          echo "[DEFAULT]"
          echo "host = $DATABRICKS_HOST"
          echo "token = $(echo "$DATABRICKS_TOKEN" | tr -d '\r\n')"
        } > ~/.databricks/config
      env:
        DATABRICKS_HOST:  ${{ secrets.DATABRICKS_HOST }}
        DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}

    - name: Upload notebook
      run: |
        databricks workspace import etl_srbija.py \
          /Shared/etl_srbija \
          --language PYTHON --format SOURCE --overwrite
      env:
        DATABRICKS_HOST:  ${{ secrets.DATABRICKS_HOST }}
        DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}



