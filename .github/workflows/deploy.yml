name: Deploy to Databricks

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    # 1) Checkout koda
    - uses: actions/checkout@v3

    # 2) Instaliraj Databricks CLI
    - name: Install Databricks CLI
      run: pip install databricks-cli

    # 3) KonfiguriÅ¡i CLI (host + token iz GitHub secrets)
    - name: Configure CLI
      run: |
        mkdir -p ~/.databricks
        cat > ~/.databricks/config <<EOF
        [DEFAULT]
        host = $DATABRICKS_HOST
        token = $DATABRICKS_TOKEN
        EOF
      env:
        DATABRICKS_HOST: ${{ secrets.DATABRICKS_HOST }}
        DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}

    # 4) Upload notebook (bez lomljenja linije, bez komentara)
    - name: Upload notebook
      run: |
        databricks workspace import etl_srbija.py /Users/kajkusemil2103@gmail.com/etl/etl_srbija.py --language PYTHON --format SOURCE --overwrite
      env:
        DATABRICKS_HOST: ${{ secrets.DATABRICKS_HOST }}
        DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}

